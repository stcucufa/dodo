<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>ðŸ¦¤ Dodo</title>
        <script type="module">

import { parse } from "../parser.js";
import { transform, evaluate } from "../transform.js";

// Parse and trasnform

const tr = parse(`
{ transform
    { match { element }
        <{ name-of }{ apply { attributes-of } }>{ apply { content-of } }</{ name-of }>
    }
    { match { attribute } { space }{ name-of }="{ escape-string { value-of } }" }
    { match { text } { escape-html { value-of } } }
}
`);

const input = parse(`
{ p class: intro This is a paragraph. }
`);

transform(tr, input).then(result => {
    console.log(result);

    // Evaluate

    const Environment = {
        I: x => x,
        "+": (...args) => args.reduce((x, y) => x + y, 0),
    };

    for (const expr of [
        "{ I `23 }",
        "{ define: Ï€ `3.141592653589793 (half of Ï„) }",
        "{ define `{ double x } { + `x `x } }",
        // FIXME 2K05 Better Lisp evaluator
        // "{ double `Ï€ }",
        // "{ define `{ fib x } { if { < `x `2 } `x { + { fib { - `x `1  } } { fib { - `x `2 } } } } }",
        // "{ = { fib `19 } `4181 }",
        // "{ define: square { Î»: x { * `x `x } } }",
        // "{ square `Ï€ }",
        // "{ { Î»: x { + `x `1 } } `2 }"
    ]) {
        console.log(evaluate.call({}, parse(expr).root, Environment));
    }
});

        </script>
    </head>
    <body>
    </body>
</html>
